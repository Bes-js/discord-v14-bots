const { WebhookClient, EmbedBuilder, AuditLogEvent, Events, Collection, ChannelType, PermissionFlagsBits } = require('discord.js')
let { BEÅž } = require('./beÅŸ_client');
let conf = require('./beÅŸ_config');
const { scheduleJob } = require("node-schedule");
const { YamlDatabase } = require('five.db');
const { readdir } = require('fs');
let { log } = console;
const { codeBlock } = require('@discordjs/formatters');
const { VanityClient } = require('discord-url');
const urlClient = new VanityClient(conf.selfBotToken, conf.guildID, true)

let mainShield = global.mainShield = new BEÅž();
let roleShield = new BEÅž();
let channelShield = new BEÅž();
let otherShield = new BEÅž()
const db = global.db = new YamlDatabase();

const webHook = new WebhookClient({ url: conf.WebHookURL });
async function send(message, entry) {
    let beÅŸ_embed = new EmbedBuilder()
        .setColor("#2f3136")
        .setThumbnail(entry.avatarURL({ dynamic: true }))
        .setDescription(`${message}`)
    return webHook.send({ embeds: [beÅŸ_embed] }).catch(err => {
        console.err("Webhook GÃ¶nderiminde Bir Hata GerÃ§ekleÅŸti!")
    })
}

async function mainBots(id) {
    if (id == mainShield.user.id || id == roleShield.user.id || id == otherShield.user.id || id == channelShield.user.id) return true;
    return false;
}

async function checkWhitelist(id) {
    let member = mainShield.guilds.cache.get(conf.guildID).members.cache.get(id);
    let data = await db.get(`whitelist_${conf.guildID}`) || [];
    if (member && data.some(id => member.id == id) || data.some(id => member.roles.cache.has(id))) return true;
    return false;
}

let perms = conf.staffPerms;
async function punish(client, member, type) {
    if (!["kick", "ban", "ytÃ§ek", "jail"].some(bes => type == bes)) return console.error("Punish Ä°ÅŸlemi YanlÄ±ÅŸ BelirtilmiÅŸ!\nytÃ§ek,ban,jail veya kick Olarak Giriniz!")
    let guild = client.guilds.cache.get(conf.guildID);
    let user = guild.members.cache.get(member);
    switch (type) {
        case 'jail':
            await user.roles.cache.has(guild.roles.premiumSubscriberRole ? message.guild.roles.premiumSubscriberRole.id : "5") ? user.roles.set([message.guild.roles.premiumSubscriberRole.id, ...conf.jailRoles]) : user.roles.set([...conf.jailRoles])
            log(`{PUNISH} ${user.user.tag} KullanÄ±cÄ±sÄ±na [JAIL] Ä°ÅŸlemi UygulandÄ±!`)
            break;
        case 'ban':
            user.ban()
            log(`{PUNISH} ${user.user.tag} KullanÄ±cÄ±sÄ±na [BAN] Ä°ÅŸlemi UygulandÄ±!`)
            break;
        case 'kick':
            user.kick()
            log(`{PUNISH} ${user.user.tag} KullanÄ±cÄ±sÄ±na [KICK] Ä°ÅŸlemi UygulandÄ±!`)
            break;
        case 'ytÃ§ek':
            await user.roles.remove(user.roles.cache.filter((bes) => bes.editable && bes.name !== "@everyone" && perms.some(perm => bes.permissions.has(perm))).map((bes) => bes.id));
            log(`{PUNISH} ${user.user.tag} KullanÄ±cÄ±sÄ±na [YETKÄ° Ã‡EKME] Ä°ÅŸlemi UygulandÄ±!`)
            break;
    }

}

const commands = mainShield.commands = new Collection();
const aliases = mainShield.aliases = new Collection();
readdir("./beÅŸ_commands/", (err, files) => {
    if (err) console.error(err)
    files.forEach(f => {
        readdir("./beÅŸ_commands/" + f, (err2, files2) => {
            if (err2) console.log(err2)
            files2.forEach(file => {
                let beÅŸ_prop = require(`./beÅŸ_commands/${f}/` + file);
                console.log(`ðŸ§® [BEÅž - COMMANDS] ${beÅŸ_prop.name} YÃ¼klendi!`);
                commands.set(beÅŸ_prop.name, beÅŸ_prop);
                beÅŸ_prop.aliases.forEach(alias => { aliases.set(alias, beÅŸ_prop.name); });
            });
        });
    });
});

mainShield.on(Events.MessageCreate, async (message) => {
    if (conf.prefix && !message.content.startsWith(conf.prefix)) return;
    const args = message.content.slice(1).trim().split(/ +/g);
    const commands = args.shift().toLowerCase();
    const cmd = mainShield.commands.get(commands) || [...mainShield.commands.values()].find((e) => e.aliases && e.aliases.includes(commands));
    const beÅŸ_embed = new EmbedBuilder()
        .setColor(`#2f3136`)
        .setAuthor({ name: message.member.displayName, iconURL: message.author.avatarURL({ dynamic: true, size: 2048 }) })
        .setFooter({ text: conf && conf.presence.length > 0 ? conf.presence : "BeÅŸ Was Here", iconURL: message.author.avatarURL({ dynamic: true, size: 2048 }) })
    if (cmd) {
        cmd.execute(mainShield, message, args, beÅŸ_embed);
    }
})

mainShield.on(Events.ClientReady, async () => {
    log(`${mainShield.user.tag} Aktif!`)
})
mainShield.login(conf.mainShield)

roleShield.on(Events.ClientReady, async () => {
    log(`${roleShield.user.tag} Aktif!`)
})
roleShield.login(conf.roleShield)

channelShield.on(Events.ClientReady, async () => {
    log(`${channelShield.user.tag} Aktif!`)
})
channelShield.login(conf.channelShield)

otherShield.on(Events.ClientReady, async () => {
    log(`${otherShield.user.tag} Aktif!`)
})
otherShield.login(conf.otherShield)

roleShield.on(Events.GuildMemberUpdate, async (oldMember, newMember) => {
    if (oldMember.roles.cache.size != newMember.roles.cache.size) {
        let logs = await oldMember.guild.fetchAuditLogs({ limit: 1, type: AuditLogEvent.MemberRoleUpdate });
        let entry = logs.entries.first();
        if (!entry || await mainBots(entry.executor.id) || entry.executor.id == oldMember.guild.ownerId) return;
        if (await checkWhitelist(entry.executor.id)) {
            return await send(`
            > **${entry.executor} Bir Ãœyenin RolÃ¼nÃ¼ GÃ¼ncelledi! Ãœye GÃ¼venlide OlduÄŸu Ä°Ã§in Ä°ÅŸlem UygulanmadÄ±!**
        
            > **Rol Veren/Alan KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
            > **Ä°ÅŸlem Uygulanan KiÅŸi: ${newMember.user} \`(${newMember.id})\`**
            > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
            > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
        }
        let member = await oldMember.guild.members.fetch(entry.executor.id);
        let response = member.bannable ? "Ceza UyguladÄ±m!" : "Yetkim YetmediÄŸi Ä°Ã§in Ceza UygulayamadÄ±m!"
        if (member && member.bannable) { await punish(roleShield, member.id, conf.Process.roleAddRemove) }
        newMember.roles.set(oldMember.roles.cache.map(r => r.id));
        await send(`
    > **${entry.executor} Bir Ãœyenin RolÃ¼nÃ¼ GÃ¼ncelledi! Ä°ÅŸlem Eski Haline Getirildi Ve ${response}**

    > **Rol Veren/Alan KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
    > **Ä°ÅŸlem Uygulanan KiÅŸi: ${newMember.user} \`(${newMember.id})\`**
    > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
    > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
    }
});

roleShield.on(Events.GuildRoleDelete, async (oldRole) => {
    let logs = await oldRole.guild.fetchAuditLogs({ limit: 1, type: AuditLogEvent.RoleDelete });
    let entry = logs.entries.first();
    if (!entry || await mainBots(entry.executor.id) || entry.executor.id == oldRole.guild.ownerId) return;
    if (await checkWhitelist(entry.executor.id)) {
        return await send(`
           > **${entry.executor} Bir Rol Sildi! Ãœye GÃ¼venlide OlduÄŸu Ä°Ã§in Ä°ÅŸlem UygulanmadÄ±!**

           > **Database Ãœzerinden Geri AÃ§mak Ä°Ã§in;**
           ${codeBlock("fix", `${conf.prefix}rol-kur ${oldRole.id}`)}
       
           > **RolÃ¼ Silen KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
           > **Silinen Rol: ${oldRole.name} \`(${oldRole.id})\`**
           > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
           > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
    }
    let member = await oldRole.guild.members.fetch(entry.executor.id);
    let response = member.bannable ? "Ceza UyguladÄ±m!" : "Yetkim YetmediÄŸi Ä°Ã§in Ceza UygulayamadÄ±m!"
    if (member && member.bannable) { await punish(roleShield, member.id, conf.Process.roleDelete) }

    await oldRole.guild.roles.create({
        name: oldRole.name,
        color: oldRole.color,
        hoist: oldRole.hoist,
        permissions: oldRole.permissions,
        position: oldRole.position,
        mentionable: oldRole.mentionable,
        reason: "Shield ~ Silinen Rol Geri AÃ§Ä±ldÄ±!"
    });

    await send(`
    > **${entry.executor} Bir Rol Sildi! ${response}**

    > **Database Ãœzerinden Geri AÃ§mak Ä°Ã§in;**
    ${codeBlock("fix", `${conf.prefix}rol-kur ${oldRole.id}`)}

    > **RolÃ¼ Silen KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
    > **Silinen Rol: ${oldRole.name} \`(${oldRole.id})\`**
    > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
    > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
});


roleShield.on(Events.GuildRoleCreate, async (oldRole) => {
    let logs = await oldRole.guild.fetchAuditLogs({ limit: 1, type: AuditLogEvent.RoleCreate });
    let entry = logs.entries.first();
    if (!entry || await mainBots(entry.executor.id) || entry.executor.id == oldRole.guild.ownerId) return;
    if (await checkWhitelist(entry.executor.id)) {
        return await send(`
           > **${entry.executor} Bir Rol AÃ§tÄ±! Ãœye GÃ¼venlide OlduÄŸu Ä°Ã§in Ä°ÅŸlem UygulanmadÄ±!**
           
           > **RolÃ¼ AÃ§an KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
           > **AÃ§Ä±lan Rol: ${oldRole.name} \`(${oldRole.id})\`**
           > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
           > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
    }
    let member = await oldRole.guild.members.fetch(entry.executor.id);
    let response = member.bannable ? "Ceza UyguladÄ±m!" : "Yetkim YetmediÄŸi Ä°Ã§in Ceza UygulayamadÄ±m!"
    if (member && member.bannable) { await punish(roleShield, member.id, conf.Process.roleCreate) }
    oldRole.delete({ reason: `Shield ~ Ä°zinsiz Rol AÃ§ma Ä°ÅŸlemi!` })
    await send(`
> **${entry.executor} Bir Rol AÃ§tÄ±! ${response}**

> **RolÃ¼ AÃ§an KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
> **AÃ§Ä±lan Rol: ${oldRole.name} \`(${oldRole.id})\`**
> **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
> **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
});

roleShield.on(Events.GuildRoleUpdate, async (oldRole, newRole) => {
    let logs = await oldRole.guild.fetchAuditLogs({ limit: 1, type: AuditLogEvent.RoleUpdate });
    let entry = logs.entries.first();
    if (!entry || await mainBots(entry.executor.id) || entry.executor.id == oldRole.guild.ownerId) return;
    if (await checkWhitelist(entry.executor.id)) {
        return await send(`
        > **${entry.executor} Bir Rol GÃ¼ncellendi! Ãœye GÃ¼venlide OlduÄŸu Ä°Ã§in Ä°ÅŸlem UygulanmadÄ±!**
           
        > **RolÃ¼ DÃ¼zenliyen KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
        > **DÃ¼zenlenen Rol: ${oldRole.name} \`(${oldRole.id})\`**
        > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
        > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
    }
    let member = await oldRole.guild.members.fetch(entry.executor.id);
    let response = member.bannable ? "Ceza UyguladÄ±m!" : "Yetkim YetmediÄŸi Ä°Ã§in Ceza UygulayamadÄ±m!"
    if (member && member.bannable) { await punish(roleShield, member.id, conf.Process.roleUpdate) }
    newRole.edit({
        name: oldRole.name,
        color: oldRole.color,
        hoist: oldRole.hoist,
        permissions: oldRole.permissions,
        position: oldRole.position,
        mentionable: oldRole.mentionable,
        reason: `Shield ~ Ä°zinsiz Rol GÃ¼ncelleme Ä°ÅŸlemi!`
    })

    await send(`
> **${entry.executor} Bir Rol GÃ¼ncellendi! ${response}**

> **RolÃ¼ DÃ¼zenliyen KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
> **DÃ¼zenlenen Rol: ${oldRole.name} \`(${oldRole.id})\`**
> **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
> **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
});



channelShield.on(Events.ChannelDelete, async (oldChannel, newChannel) => {
    let logs = await oldChannel.guild.fetchAuditLogs({ limit: 1, type: AuditLogEvent.ChannelDelete });
    let entry = logs.entries.first();
    if (!entry) return;
    let tÃ¼r = { 2: "Ses KanalÄ±", 0: "Metin KanalÄ±", 5: "Duyuru KanalÄ±", 4: "Kategori", 13: "Sahne", 15: "Forum" }
    if (!entry || await mainBots(entry.executor.id) || entry.executor.id == oldChannel.guild.ownerId) return;
    if (await checkWhitelist(entry.executor.id)) {
        return await send(`
        > **${entry.executor} Bir Kanal Silindi! Ãœye GÃ¼venlide OlduÄŸu Ä°Ã§in Ä°ÅŸlem UygulanmadÄ±!**
           
        > **Database Ãœzerinden Geri AÃ§mak Ä°Ã§in;**
        ${codeBlock("fix", `${conf.prefix}kanal-kur ${oldChannel.id}`)}

        > **KanalÄ± Silen KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
        > **Silinen Kanal: ${oldChannel.name} \`(${oldChannel.id})\` [\`${tÃ¼r[oldChannel.type]}\`]**
        > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
        > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
    }
    let member = await oldChannel.guild.members.fetch(entry.executor.id);
    let response = member.bannable ? "Ceza UyguladÄ±m!" : "Yetkim YetmediÄŸi Ä°Ã§in Ceza UygulayamadÄ±m!"
    if (member && member.bannable) { await punish(channelShield, member.id, conf.Process.channelDelete) }
    if (oldChannel.type == 4) {
        oldChannel.guild.channels.create({
            name: oldChannel.name,
            rawPosition: oldChannel.rawPosition,
            type: ChannelType.GuildCategory
        })
    } else {
        oldChannel.clone({ parent: oldChannel.parentId })
    }

    await send(`
> **${entry.executor} Bir Kanal Silindi! ${response}**

> **Database Ãœzerinden Geri AÃ§mak Ä°Ã§in;**
${codeBlock("fix", `${conf.prefix}kanal-kur ${oldChannel.id}`)}

> **KanalÄ± Silen KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
> **Silinen Kanal: ${oldChannel.name} \`(${oldChannel.id})\` [\`${tÃ¼r[oldChannel.type]}\`]**
> **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
> **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
});

channelShield.on(Events.ChannelCreate, async (oldChannel) => {
    let logs = await oldChannel.guild.fetchAuditLogs({ limit: 1, type: AuditLogEvent.ChannelCreate });
    let entry = logs.entries.first();
    let tÃ¼r = { 2: "Ses KanalÄ±", 0: "Metin KanalÄ±", 5: "Duyuru KanalÄ±", 4: "Kategori", 13: "Sahne", 15: "Forum" }
    if (!entry || await mainBots(entry.executor.id) || entry.executor.id == oldChannel.guild.ownerId) return;
    if (await checkWhitelist(entry.executor.id)) {
        return await send(`
        > **${entry.executor} Bir Kanal AÃ§Ä±ldÄ±! Ãœye GÃ¼venlide OlduÄŸu Ä°Ã§in Ä°ÅŸlem UygulanmadÄ±!**
           
        > **KanalÄ± AÃ§an KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
        > **AÃ§Ä±lan Kanal: ${oldChannel.name} \`(${oldChannel.id})\` [\`${tÃ¼r[oldChannel.type]}\`]**
        > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
        > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
    }
    let member = await oldChannel.guild.members.fetch(entry.executor.id);
    let response = member.bannable ? "Ceza UyguladÄ±m!" : "Yetkim YetmediÄŸi Ä°Ã§in Ceza UygulayamadÄ±m!"
    if (member && member.bannable) { await punish(channelShield, member.id, conf.Process.channelCreate) }

    oldChannel.delete({ reason: `Shield ~ Ä°zinsiz Kanal AÃ§ma Ä°ÅŸlemi!` })

    await send(`
> **${entry.executor} Bir Kanal AÃ§Ä±ldÄ±! ${response}**

> **KanalÄ± AÃ§an KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
> **AÃ§Ä±lan Kanal: ${oldChannel.name} \`(${oldChannel.id})\` [\`${tÃ¼r[oldChannel.type]}\`]**
> **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
> **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
});

channelShield.on(Events.ChannelUpdate, async (oldChannel, newChannel) => {
    let logs = await oldChannel.guild.fetchAuditLogs({ limit: 1, type: AuditLogEvent.ChannelUpdate });
    let entry = logs.entries.first();
    let tÃ¼r = { 2: "Ses KanalÄ±", 0: "Metin KanalÄ±", 5: "Duyuru KanalÄ±", 4: "Kategori", 13: "Sahne", 15: "Forum" }
    if (!entry || await mainBots(entry.executor.id) || entry.executor.id == oldChannel.guild.ownerId) return;
    if (await checkWhitelist(entry.executor.id)) {
        return await send(`
        > **${entry.executor} Bir Kanal GÃ¼ncellendi! Ãœye GÃ¼venlide OlduÄŸu Ä°Ã§in Ä°ÅŸlem UygulanmadÄ±!**
           
        > **KanalÄ± GÃ¼ncelliyen KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
        > **GÃ¼ncellenen Kanal: ${oldChannel.name} \`(${oldChannel.id})\` [\`${tÃ¼r[oldChannel.type]}\`]**
        > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
        > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
    }
    let member = await oldChannel.guild.members.fetch(entry.executor.id);
    let response = member.bannable ? "Ceza UyguladÄ±m!" : "Yetkim YetmediÄŸi Ä°Ã§in Ceza UygulayamadÄ±m!"
    if (member && member.bannable) { await punish(channelShield, member.id, conf.Process.channelUpdate) }
    
    oldChannel.guild.channels.edit(newChannel.id,{
        name:oldChannel.name,
        position:oldChannel.position,
        topic:oldChannel.topic,
        nsfw:oldChannel.nsfw,
        parent:oldChannel.parent,
        userLimit:oldChannel.userLimit,
        bitrate:oldChannel.bitrate,
    })


    await send(`
> **${entry.executor} Bir Kanal GÃ¼ncellendi! ${response}**

> **KanalÄ± GÃ¼ncelliyen KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
> **GÃ¼ncellenen Kanal: ${oldChannel.name} \`(${oldChannel.id})\` [\`${tÃ¼r[oldChannel.type]}\`]**
> **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
> **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)

});


channelShield.on(Events.ChannelUpdate, async (oldChannel, newChannel) => {
    let logs = await oldChannel.guild.fetchAuditLogs({ limit: 1, type: AuditLogEvent.ChannelOverwriteUpdate });
    let entry = logs.entries.first();
    let tÃ¼r = { 2: "Ses KanalÄ±", 0: "Metin KanalÄ±", 5: "Duyuru KanalÄ±", 4: "Kategori", 13: "Sahne", 15: "Forum" }
    if (!entry || await mainBots(entry.executor.id) || entry.executor.id == oldChannel.guild.ownerId) return;
    if (await checkWhitelist(entry.executor.id)) {
        return await send(`
        > **${entry.executor} Bir Kanal Ä°zinleri GÃ¼ncellendi! Ãœye GÃ¼venlide OlduÄŸu Ä°Ã§in Ä°ÅŸlem UygulanmadÄ±!**
           
        > **KanalÄ± GÃ¼ncelliyen KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
        > **GÃ¼ncellenen Kanal: ${oldChannel.name} \`(${oldChannel.id})\` [\`${tÃ¼r[oldChannel.type]}\`]**
        > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
        > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
    }
    let member = await oldChannel.guild.members.fetch(entry.executor.id);
    let response = member.bannable ? "Ceza UyguladÄ±m!" : "Yetkim YetmediÄŸi Ä°Ã§in Ceza UygulayamadÄ±m!"
    if (member && member.bannable) { await punish(channelShield, member.id, conf.Process.channelUpdate) }

    await newChannel.permissionOverwrites.set([...oldChannel.permissionOverwrites.cache.values()]);

    await send(`
> **${entry.executor} Bir Kanal Ä°zinleri GÃ¼ncellendi! ${response}**

> **KanalÄ± GÃ¼ncelliyen KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
> **GÃ¼ncellenen Kanal: ${oldChannel.name} \`(${oldChannel.id})\` [\`${tÃ¼r[oldChannel.type]}\`]**
> **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
> **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)

});



mainShield.on(Events.GuildUpdate, async (oldGuild, newGuild) => {
    if (oldGuild.vanityURLCode !== newGuild.vanityURLCode) {
        let logs = await oldGuild.guild.fetchAuditLogs({ limit: 1, type: AuditLogEvent.GuildUpdate });
        let entry = logs.entries.first();
        if (!entry || await mainBots(entry.executor.id) || entry.executor.id == oldGuild.ownerId) return;
        let member = await oldGuild.guild.members.fetch(entry.executor.id);
        let response = member.bannable ? "Ceza UyguladÄ±m!" : "Yetkim YetmediÄŸi Ä°Ã§in Ceza UygulayamadÄ±m!"
        if (member && member.bannable) { await punish(mainShield, member.id, conf.Process.urlUpdate) }
        urlClient.setVanityURL(conf.vanityURL).catch(err=>{});
        await send(`
> **${entry.executor} KullanÄ±cÄ±sÄ± URL Ãœzerinde Ä°ÅŸlem GerÃ§ekleÅŸtirdi! ${response}**

> **URL'ye Ä°ÅŸlem Yapan KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
> **Eski URL: \`${oldGuild.vanityURLCode}\`**
> **DeÄŸiÅŸtirilen URL: \`${newGuild.vanityURLCode}\`**
> **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
> **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
    }
});
urlClient.on("VanitySuccess", async (response) => { log(`${response.vanityURL} URL'si BaÅŸarÄ±yla AlÄ±ndÄ±`) })
urlClient.on('VanityError', async (error) => { log(`URL AlÄ±nÄ±rken Bir Hata Meydana Geldi!!\nHata; ${error.error}`); })
}

mainShield.on(Events.GuildUpdate, async (oldGuild, newGuild) => {
    if ((oldGuild.splash !== newGuild.splash) || (oldGuild.iconURL() !== newGuild.iconURL()) || (oldGuild.name !== newGuild.name) || (oldGuild.bannerURL() !== newGuild.bannerURL())) {
        let logs = await oldGuild.fetchAuditLogs({ limit: 1, type: AuditLogEvent.GuildUpdate });
        let entry = logs.entries.first();
        if (!entry || await mainBots(entry.executor.id) || entry.executor.id == oldGuild.ownerId) return;
    if (await checkWhitelist(entry.executor.id)) {
        return await send(`
        > **${entry.executor} KullanÄ±cÄ±sÄ± Sunucu Ãœzerinde Ä°ÅŸlem GerÃ§ekleÅŸtirdi! Ãœye GÃ¼venlide OlduÄŸu Ä°Ã§in Ä°ÅŸlem UygulanmadÄ±!**
           
        > **Ä°ÅŸlem Yapan KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
        > **Eski Sunucu Bilgileri: \`${oldGuild.name}\` ${oldGuild.bannerURL() !== null ? `[Banner](${oldGuild.bannerURL()})` : ""} ${oldGuild.iconURL() !== null ? `[Icon](${oldGuild.iconURL()})` : ""} ${oldGuild.splash !== null ? `[Invite Banner](${oldGuild.splash})` : ""}**
        > **DeÄŸiÅŸen Sunucu Bilgileri: \`${newGuild.name}\` ${newGuild.bannerURL() !== null ? `[Banner](${newGuild.bannerURL()})` : ""} ${newGuild.iconURL() !== null ? `[Icon](${newGuild.iconURL()})` : ""} ${newGuild.splash !== null ? `[Invite Banner](${newGuild.splash})` : ""}**
        > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
        > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
    }
        let member = await oldGuild.members.fetch(entry.executor.id);
        let response = member.bannable ? "Ceza UyguladÄ±m!" : "Yetkim YetmediÄŸi Ä°Ã§in Ceza UygulayamadÄ±m!"
        if (member && member.bannable) { await punish(mainShield, member.id, conf.Process.serverUpdate) }
        if (oldGuild.iconURL() !== newGuild.iconURL()) newGuild.setIcon(oldGuild.iconURL({ dynamic: true }))
        if (oldGuild.bannerURL() !== newGuild.bannerURL()) newGuild.setBanner(oldGuild.bannerURL({ size: 2048, dynamic: true }))
        if (oldGuild.name !== newGuild.name) newGuild.setName(oldGuild.name)
        if (oldGuild.splash !== newGuild.splash) newGuild.setSplash(oldGuild.splash)
        await send(`
> **${entry.executor} KullanÄ±cÄ±sÄ± Sunucu Ãœzerinde Ä°ÅŸlem GerÃ§ekleÅŸtirdi! ${response}**

> **Ä°ÅŸlem Yapan KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
> **Eski Sunucu Bilgileri: \`${oldGuild.name}\` ${oldGuild.bannerURL() !== null ? `[Banner](${oldGuild.bannerURL()})` : ""} ${oldGuild.iconURL() !== null ? `[Icon](${oldGuild.iconURL()})` : ""} ${oldGuild.splash !== null ? `[Invite Banner](${oldGuild.splash})` : ""}**
> **DeÄŸiÅŸen Sunucu Bilgileri: \`${newGuild.name}\` ${newGuild.bannerURL() !== null ? `[Banner](${newGuild.bannerURL()})` : ""} ${newGuild.iconURL() !== null ? `[Icon](${newGuild.iconURL()})` : ""} ${newGuild.splash !== null ? `[Invite Banner](${newGuild.splash})` : ""}**
> **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
> **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
    }
});
const AntiSpam = require("discord-anti-spam");
const { channel } = require('diagnostics_channel');
const antiSpam = new AntiSpam(conf.antiSpam);
otherShield.on(Events.MessageCreate, async (message) => { antiSpam.message(message); })
otherShield.on(Events.GuildMemberRemove, async (member) => { antiSpam.userleave(member); });

otherShield.on(Events.GuildEmojiCreate, async (emoji) => {
    let logs = await emoji.guild.fetchAuditLogs({ limit: 1, type: AuditLogEvent.EmojiCreate });
    let entry = logs.entries.first();
    if (!entry || await mainBots(entry.executor.id) || entry.executor.id == emoji.guild.ownerId) return;
    if (await checkWhitelist(entry.executor.id)) {
        return await send(`
        > **${entry.executor} Bir Emoji OluÅŸturdu! Ãœye GÃ¼venlide OlduÄŸu Ä°Ã§in Ä°ÅŸlem UygulanmadÄ±!**
        
        > **OluÅŸturan KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
        > **Emoji Bilgileri: \`${emoji.name}\` [Emoji URL](${emoji.url})**
        > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
        > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
    }
    let member = await emoji.guild.members.fetch(entry.executor.id);
    let response = member.bannable ? "Ceza UyguladÄ±m!" : "Yetkim YetmediÄŸi Ä°Ã§in Ceza UygulayamadÄ±m!"
    if (member && member.bannable) { await punish(otherShield, member.id, conf.Process.emojiCreate) }
    emoji.delete();
    await send(`
> **${entry.executor} Bir Emoji OluÅŸturdu! ${response}**

> **OluÅŸturan KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
> **Emoji Bilgileri: \`${emoji.name}\` [Emoji URL](${emoji.url})**
> **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
> **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
})

otherShield.on(Events.GuildEmojiDelete, async (emoji) => {
    let logs = await emoji.guild.fetchAuditLogs({ limit: 1, type: AuditLogEvent.EmojiDelete });
    let entry = logs.entries.first();
    if (!entry || await mainBots(entry.executor.id) || entry.executor.id == emoji.guild.ownerId) return;
    if (await checkWhitelist(entry.executor.id)) {
        return await send(`
   > **${entry.executor} Bir Emoji Sildi! Ãœye GÃ¼venlide OlduÄŸu Ä°Ã§in Ä°ÅŸlem UygulanmadÄ±!**
   
   > **Silen KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
   > **Emoji Bilgileri: \`${emoji.name}\` [Emoji URL](${emoji.url})**
   > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
   > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
    }
    let member = await emoji.guild.members.fetch(entry.executor.id);
    let response = member.bannable ? "Ceza UyguladÄ±m!" : "Yetkim YetmediÄŸi Ä°Ã§in Ceza UygulayamadÄ±m!"
    if (member && member.bannable) { await punish(otherShield, member.id, conf.Process.emojiDelete) }
    emoji.guild.emojis.create({ attachment: emoji.url, name: emoji.name })
    await send(`
> **${entry.executor} Bir Emoji Sildi! ${response}**

> **Silen KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
> **Emoji Bilgileri: \`${emoji.name}\` [Emoji URL](${emoji.url})**
> **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
> **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
})


otherShield.on(Events.GuildEmojiUpdate, async (oldEmoji, newEmoji) => {
    let logs = await oldEmoji.guild.fetchAuditLogs({ limit: 1, type: AuditLogEvent.EmojiUpdate });
    let entry = logs.entries.first();
    if (!entry || await mainBots(entry.executor.id) || entry.executor.id == oldEmoji.guild.ownerId) return;
    if (await checkWhitelist(entry.executor.id)) {
        return await send(`
   > **${entry.executor} Bir Emoji GÃ¼ncelledi! Ãœye GÃ¼venlide OlduÄŸu Ä°Ã§in Ä°ÅŸlem UygulanmadÄ±!**
   
   > **GÃ¼ncelleyen KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
   > **Eski Emoji Bilgileri: \`${oldEmoji.name}\` [Emoji URL](${oldEmoji.url})**
   > **Yeni Emoji Bilgileri: \`${newEmoji.name}\` [Emoji URL](${newEmoji.url})**
   > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
   > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
    }
    let member = await oldEmoji.guild.members.fetch(entry.executor.id);
    let response = member.bannable ? "Ceza UyguladÄ±m!" : "Yetkim YetmediÄŸi Ä°Ã§in Ceza UygulayamadÄ±m!"
    if (member && member.bannable) { await punish(otherShield, member.id, conf.Process.emojiUpdate) }
    newEmoji.edit({ name: oldEmoji.name })
    await send(`
    > **${entry.executor} Bir Emoji GÃ¼ncelledi! ${response}**

   > **GÃ¼ncelleyen KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
   > **Eski Emoji Bilgileri: \`${oldEmoji.name}\` [Emoji URL](${oldEmoji.url})**
   > **Yeni Emoji Bilgileri: \`${newEmoji.name}\` [Emoji URL](${newEmoji.url})**
   > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
   > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
})

otherShield.on(Events.GuildStickerCreate, async (sticker) => {
    let logs = await sticker.guild.fetchAuditLogs({ limit: 1, type: AuditLogEvent.StickerCreate });
    let entry = logs.entries.first();
    if (!entry || await mainBots(entry.executor.id) || entry.executor.id == sticker.guild.ownerId) return;
    if (await checkWhitelist(entry.executor.id)) {
        return await send(`
   > **${entry.executor} Bir Sticker OluÅŸturdu! Ãœye GÃ¼venlide OlduÄŸu Ä°Ã§in Ä°ÅŸlem UygulanmadÄ±!**
   
   > **OluÅŸturan KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
   > **Sticker Bilgileri: \`${sticker.name}\` [Sticker URL](${sticker.url})**
   > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
   > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
    }
    let member = await sticker.guild.members.fetch(entry.executor.id);
    let response = member.bannable ? "Ceza UyguladÄ±m!" : "Yetkim YetmediÄŸi Ä°Ã§in Ceza UygulayamadÄ±m!"
    if (member && member.bannable) { await punish(otherShield, member.id, conf.Process.stickerCreate) }
    sticker.delete()
    await send(`
    > **${entry.executor} Bir Sticker OluÅŸturdu! ${response}**

    > **OluÅŸturan KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
    > **Sticker Bilgileri: \`${sticker.name}\` [Sticker URL](${sticker.url})**
    > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
    > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
})

otherShield.on(Events.GuildStickerDelete, async (sticker) => {
    let logs = await sticker.guild.fetchAuditLogs({ limit: 1, type: AuditLogEvent.StickerDelete });
    let entry = logs.entries.first();
    if (!entry || await mainBots(entry.executor.id) || entry.executor.id == sticker.guild.ownerId) return;
    if (await checkWhitelist(entry.executor.id)) {
        return await send(`
   > **${entry.executor} Bir Sticker Sildi! Ãœye GÃ¼venlide OlduÄŸu Ä°Ã§in Ä°ÅŸlem UygulanmadÄ±!**
   
   > **Silen KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
   > **Sticker Bilgileri: \`${sticker.name}\` [Sticker URL](${sticker.url})**
   > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
   > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
    }
    let member = await sticker.guild.members.fetch(entry.executor.id);
    let response = member.bannable ? "Ceza UyguladÄ±m!" : "Yetkim YetmediÄŸi Ä°Ã§in Ceza UygulayamadÄ±m!"
    if (member && member.bannable) { await punish(otherShield, member.id, conf.Process.stickerDelete) }
    sticker.guild.stickers.create({ file: sticker.url, name: sticker.name, tags: sticker.tags, description: sticker.description })
    await send(`
    > **${entry.executor} Bir Sticker Sildi! ${response}**

    > **Silen KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
    > **Sticker Bilgileri: \`${sticker.name}\` [Sticker URL](${sticker.url})**
    > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
    > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
})

otherShield.on(Events.GuildStickerUpdate, async (oldSticker, newSticker) => {
    let logs = await oldSticker.guild.fetchAuditLogs({ limit: 1, type: AuditLogEvent.StickerUpdate });
    let entry = logs.entries.first();
    if (!entry || await mainBots(entry.executor.id) || entry.executor.id == oldSticker.guild.ownerId) return;
    if (await checkWhitelist(entry.executor.id)) {
        return await send(`
   > **${entry.executor} Bir Sticker GÃ¼ncelledi! Ãœye GÃ¼venlide OlduÄŸu Ä°Ã§in Ä°ÅŸlem UygulanmadÄ±!**
   
   > **GÃ¼ncelleyen KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
   > **Eski Sticker Bilgileri: \`${oldSticker.name}\` [Sticker URL](${oldSticker.url})**
   > **Yeni Sticker Bilgileri: \`${newSticker.name}\` [Sticker URL](${newSticker.url})**
   > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
   > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
    }
    let member = await oldSticker.guild.members.fetch(entry.executor.id);
    let response = member.bannable ? "Ceza UyguladÄ±m!" : "Yetkim YetmediÄŸi Ä°Ã§in Ceza UygulayamadÄ±m!"
    if (member && member.bannable) { await punish(otherShield, member.id, conf.Process.stickerUpdate) }
    newSticker.edit({ name: oldSticker.name, tags: oldSticker.tags, description: oldSticker.description })
    await send(`
    > **${entry.executor} Bir Sticker GÃ¼ncelledi! ${response}**

    > **GÃ¼ncelleyen KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
    > **Eski Sticker Bilgileri: \`${oldSticker.name}\` [Sticker URL](${oldSticker.url})**
    > **Yeni Sticker Bilgileri: \`${newSticker.name}\` [Sticker URL](${newSticker.url})**
    > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
    > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
})

otherShield.on(Events.WebhooksUpdate, async (webhook) => {
    let logs = await webhook.guild.fetchAuditLogs({ limit: 1, type: AuditLogEvent.WebhookCreate });
    let entry = logs.entries.first();
    if (!entry || await mainBots(entry.executor.id) || entry.executor.id == webhook.guild.ownerId) return;
    if (await checkWhitelist(entry.executor.id)) {
        return await send(`
   > **${entry.executor} Bir Webhook OluÅŸturdu! Ãœye GÃ¼venlide OlduÄŸu Ä°Ã§in Ä°ÅŸlem UygulanmadÄ±!**
   
   > **OluÅŸturan KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
   > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
   > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
    }
    let member = await webhook.guild.members.fetch(entry.executor.id);
    let response = member.bannable ? "Ceza UyguladÄ±m!" : "Yetkim YetmediÄŸi Ä°Ã§in Ceza UygulayamadÄ±m!"
    if (member && member.bannable) { await punish(otherShield, member.id, conf.Process.webhookUpdate) }
    const webhooks = await webhook.fetchWebhooks();
    webhooks.forEach(bes => bes.delete().catch(err => { }))
    await send(`
   > **${entry.executor} Bir Webhook OluÅŸturdu! ${response}**

   > **OluÅŸturan KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
   > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
   > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
})

otherShield.on(Events.ClientReady, async () => {
    let guild = otherShield.guilds.cache.get(conf.guildID);
    let channel = guild.channels.cache.find(bes => bes.name == "others-log");
    if(!guild || !channel)return
    let besData = db.has(`bes_automoderation`);
    if (!besData) {
        log(`[AUTOMOD] KÃ¼fÃ¼r Filtresi BaÅŸarÄ±yla Kuruldu!`)
        guild.autoModerationRules.create({
            name: `BeÅŸ TarafÄ±ndan!`, creatorId: otherShield.user.id, enabled: true, eventType: 1, triggerType: 1,
            triggerMetadata: { keywordFilter: conf.Curses }, actions: [{ type: 1, metadata:{channel:channel,durationSeconds: 10, customMessage: "Sunucumuzda Argo & KÃ¼fÃ¼rlÃ¼ KonuÅŸmak YasaktÄ±r!" } }]
        })
        guild.autoModerationRules.create({
            name: `BeÅŸ TarafÄ±ndan!`, creatorId: otherShield.user.id, enabled: true, eventType: 1, triggerType: 1,
            triggerMetadata: { keywordFilter: conf.Ads }, actions: [{ type: 1, metadata: {channel:channel,durationSeconds: 10, customMessage: "Sunucumuzda Link & Reklam Yapmak YasaktÄ±r!" } }]
        })
        db.set(`bes_automoderation`, true)
    } else return;
})

mainShield.on(Events.PresenceUpdate,async(oldUser, newUser) => {
const status = Object.keys(newUser.clientStatus);
if (!newUser.user.bot && newUser.guild.id == conf.guildID && conf.staffPerms.some(bes => newUser.member.permissions.has(bes))){
if(status.find(bes => bes === "web")) {
    let guild = mainShield.guilds.cache.get(conf.guildID);
    if (newUser.user.id == guild.ownerId) return;
    let member = guild.members.cache.get(newUser.user.id)
    if (!member || await mainBots(member.user.id)) return;
    log(`[WEB] ${member.user.tag} KullanÄ±cÄ±sÄ± Web Ãœzerinden GiriÅŸ YaptÄ±!`)
    if (await checkWhitelist(member.user.id)) {
        return await send(`
   > **${member} KullanÄ±cÄ± [WEB] Ãœzerinden GiriÅŸ YaptÄ±! Ãœye GÃ¼venlide OlduÄŸu Ä°Ã§in Ä°ÅŸlem UygulanmadÄ±!**
   
   > **KiÅŸi: ${member} \`(${member.user.id})\`**
   > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
   > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, member.user)
    }
    let response = member.bannable ? "Ceza UyguladÄ±m!" : "Yetkim YetmediÄŸi Ä°Ã§in Ceza UygulayamadÄ±m!"
    if (member && member.bannable) { await punish(mainShield, member.id, conf.Process.webLogin) }
    await send(`
    > **${member} KullanÄ±cÄ± [WEB] Ãœzerinden GiriÅŸ YaptÄ±! ${response}**

    > **KiÅŸi: ${member} \`(${member.user.id})\`**
    > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
    > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, member.user)
 }}
})

otherShield.on(Events.GuildMemberAdd,async(member) => {
    if(!member.user.bot)return;
    let logs = await member.guild.fetchAuditLogs({ limit: 1, type: AuditLogEvent.BotAdd });
    let entry = logs.entries.first();
    if (!entry || await mainBots(entry.executor.id) || entry.executor.id == member.guild.ownerId) return;
    if (await checkWhitelist(entry.executor.id)) {
        return await send(`
   > **${entry.executor} Bir Bot Ekledi! Ãœye GÃ¼venlide OlduÄŸu Ä°Ã§in Ä°ÅŸlem UygulanmadÄ±!**
   
   > **Ekliyen KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
   > **Eklenen Bot: ${member.user.tag} \`(${member.user.id})\`**
   > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
   > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
    }
    let memberBes = await member.guild.members.fetch(entry.executor.id);
    let response = memberBes.bannable ? "Ceza UyguladÄ±m!" : "Yetkim YetmediÄŸi Ä°Ã§in Ceza UygulayamadÄ±m!"
    if (member && member.bannable) { await punish(otherShield, member.id, "ban") }
    if (memberBes && memberBes.bannable) { await punish(otherShield, memberBes.id, conf.Process.botAdd) }
    await send(`
    > **${entry.executor} Bir Bot Ekledi! ${response}**

    > **Ekliyen KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
    > **Eklenen Bot: ${member.user.tag} \`(${member.user.id})\`**
    > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
    > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
    
})

otherShield.on(Events.GuildBanAdd,async(member) => {
    let logs = await member.guild.fetchAuditLogs({ limit: 1, type: AuditLogEvent.MemberBanAdd });
    let entry = logs.entries.first();
    if (!entry || await mainBots(entry.executor.id) || entry.executor.id == member.guild.ownerId) return;
    if (await checkWhitelist(entry.executor.id)) {
        return await send(`
   > **${entry.executor} Bir KullanÄ±cÄ±yÄ± BanladÄ±! Ãœye GÃ¼venlide OlduÄŸu Ä°Ã§in Ä°ÅŸlem UygulanmadÄ±!**
   
   > **Banlayan KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
   > **Banlanan KiÅŸi: ${member.user.tag} \`(${member.user.id})\`**
   > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
   > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
    }
    let memberBes = await member.guild.members.fetch(entry.executor.id);
    let response = memberBes.bannable ? "Ceza UyguladÄ±m!" : "Yetkim YetmediÄŸi Ä°Ã§in Ceza UygulayamadÄ±m!"
    if (memberBes && memberBes.bannable) { await punish(otherShield, memberBes.id, conf.Process.memberBanAdd) }
    member.guild.members.unban(member.user.id)
    await send(`
    > **${entry.executor} Bir KullanÄ±cÄ±yÄ± BanladÄ±! ${response}**

    > **Banlayan KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
    > **Banlanan KiÅŸi: ${member.user.tag} \`(${member.user.id})\`**
    > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
    > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor) 
})

otherShield.on(Events.GuildMemberRemove,async(member) => {
    let logs = await member.guild.fetchAuditLogs({ limit: 1, type: AuditLogEvent.MemberKick });
    let entry = logs.entries.first();
    if (!entry || await mainBots(entry.executor.id) || entry.executor.id == member.guild.ownerId) return;
    if (await checkWhitelist(entry.executor.id)) {
        return await send(`
   > **${entry.executor} Bir KullanÄ±cÄ±yÄ± Kickledi! Ãœye GÃ¼venlide OlduÄŸu Ä°Ã§in Ä°ÅŸlem UygulanmadÄ±!**
   
   > **Kickleyen KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
   > **Kicklenen KiÅŸi: ${member.user.tag} \`(${member.user.id})\`**
   > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
   > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor)
    }
    let memberBes = await member.guild.members.fetch(entry.executor.id);
    let response = memberBes.bannable ? "Ceza UyguladÄ±m!" : "Yetkim YetmediÄŸi Ä°Ã§in Ceza UygulayamadÄ±m!"
    if (memberBes && memberBes.bannable) { await punish(otherShield, memberBes.id, conf.Process.memberKickAdd) }
    await send(`
    > **${entry.executor} Bir KullanÄ±cÄ±yÄ± Kickledi! ${response}**

    > **Kickleyen KiÅŸi: ${entry.executor} \`(${entry.executor.id})\`**
    > **Kicklenen KiÅŸi: ${member.user.tag} \`(${member.user.id})\`**
    > **Tarih: <t:${Math.floor(Date.now() / 1000)}>**
    > **Unix Zaman: <t:${Math.floor(Date.now() / 1000)}:R>**`, entry.executor) 
})


scheduleJob('0 0 */2 * * *',async () => {
if(conf.autoBackup){
let guild = mainShield.guilds.cache.get(conf.guildID);
log(`[AUTO BACKUP] Yeni Sunucu YedeÄŸi AlÄ±nÄ±yor!`)
await roleBackUp(guild,conf.guildID)
await channelBackUp(guild,conf.guildID)
}
});
async function roleBackUp(guild, guildID) {
    if (db.all().includes("roleBackup_")) {
        db.all().filter(data => data.ID.includes("roleBackup_")).forEach(data => {
            db.delete(data.ID)
        })
    }
    guild.roles.cache.forEach(async role => {
        let rolePerms = [];
        await guild.channels.cache.filter(beÅŸ =>
            beÅŸ.permissionOverwrites.cache.has(role.id)).forEach(bes => {
                let channelPerm = bes.permissionOverwrites.cache.get(role.id);
                rolePerms.push({ id: bes.id, allow: channelPerm.allow.toArray(), deny: channelPerm.deny.toArray() });
            });
        db.set(`roleBackup_${guildID}_${role.id}`,
            {
                roleID: role.id,
                name: role.name,
                color: role.hexColor,
                hoist: role.hoist,
                position: role.position,
                permissions: role.permissions.bitfield.toString(),
                mentionable: role.mentionable,
                members: role.members.map(m => m.id),
                writes: rolePerms
            })
    });
    log("Rollerin Verileri BaÅŸarÄ±yla Yedeklendi!")
};
async function channelBackUp(guild, guildID) {
    if (db.all().includes("channelBackup_")) {
        db.all().filter(data => data.ID.includes("channelBackup_")).forEach(data => {
            db.delete(data.ID)
        })
    }
    if (guild) {
        const channels = [...guild.channels.cache.values()];
        for (let index = 0; index < channels.length; index++) {
            const channel = channels[index];
            let chanPerms = [];
            channel.permissionOverwrites.cache.forEach(beÅŸ => {
                chanPerms.push({ id: beÅŸ.id, type: beÅŸ.type, allow: `${beÅŸ.allow.bitfield}`, deny: `${beÅŸ.deny.bitfield}` });
            });
            if (channel.type == 4) { // amal ay prdn ramoÅŸko int kuLLaNdIm hIzLÄ± oLmUÅŸMu kNk :d
                db.set(`channelBackup_${guildID}_${channel.id}`,
                    {
                        type: channel.type,
                        channelID: channel.id,
                        name: channel.name,
                        position: channel.position,
                        writes: chanPerms
                    })
            }
            if ((channel.type == 0) || (channel.type == 5)) {
                db.set(`channelBackup_${guildID}_${channel.id}`,
                    {
                        type: channel.type,
                        channelID: channel.id,
                        name: channel.name,
                        nsfw: channel.nsfw,
                        parentID: channel.parentId,
                        position: channel.position,
                        rateLimit: channel.rateLimitPerUser,
                        writes: chanPerms
                    })
            }
            if (channel.type == 2) {
                db.set(`channelBackup_${guildID}_${channel.id}`,
                    {
                        type: channel.type,
                        channelID: channel.id,
                        name: channel.name,
                        bitrate: channel.bitrate,
                        userLimit: channel.userLimit,
                        parentID: channel.parentId,
                        position: channel.position,
                        writes: chanPerms
                    })
            }
        }
        log("Kanal Verileri BaÅŸarÄ±yla Yedeklendi!");
    }
}
